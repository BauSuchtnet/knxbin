const workersUrl="https://api.knx.cool/";var haste_document=function(){this.locked=!1};htmlEscape=function(e){return e.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;")},haste_document.prototype.load=function(e,t,o){var n=this;$.ajax(workersUrl+e,{type:"get",dataType:"json",success:function(s){n.locked=!0,n.key=e,n.data=s.data,t({value:htmlEscape(n.data),key:e,language:o,lineCount:n.data.split("\n").length})},error:function(e,o,n){t(!1)}})},haste_document.prototype.save=function(e,t){if(this.locked)return!1;this.data=e;var o=this;$.ajax(workersUrl+"documents",{type:"put",data:e,dataType:"json",contentType:"text/plain; charset=utf-8",success:function(n){o.locked=!0,o.key=n.key,t(null,{value:e,key:n.key,language:null,lineCount:e.split("\n").length})},error:function(e){try{t($.parseJSON(e.responseText))}catch(e){t({message:"Something went wrong!"})}}})};var haste=function(e,t){this.appName=e,this.$textarea=$("textarea"),this.$box=$("#box"),this.$code=$("#box code"),this.$linenos=$("#linenos"),this.options=t,this.configureShortcuts(),this.configureButtons()};function highlightLine(e){var t=document.getElementById("box");removeElementsByClass("highlight");let o=document.createElement("div");o.classList.add("highlight"),o.style.marginTop=16*(e-1)+"px",t.insertBefore(o,t.firstChild)}function removeElementsByClass(e){const t=document.getElementsByClassName(e);for(;t.length>0;)t[0].parentNode.removeChild(t[0])}function highlightNew(e){const t=document.getElementsByTagName("code");let o=0;for(let e=0;e<t.length;e++)t[e].offsetWidth>o&&(o=t[e].offsetWidth),t[e].style.removeProperty("background-color");const n=$(window).width();n>o&&(o=n);for(let e=0;e<t.length;e++)t[e].style.width=o+"px";e.style.backgroundColor="rgba(187, 128, 9, 0.25)"}function getLineElement(e){return document.getElementsByTagName("code")[e-1]}haste.prototype.setTitle=function(e){var t=e?this.appName+" - "+e:this.appName;document.title=t},haste.prototype.showMessage=function(e,t){var o=$('<li class="'+(t||"info")+'">'+e+"</li>");$("#messages").prepend(o),setTimeout(function(){o.slideUp("fast",function(){$(this).remove()})},3e3)},haste.prototype.lightKey=function(){this.configureKey(["new","save"])},haste.prototype.fullKey=function(){this.configureKey(["new","duplicate","raw"])},haste.prototype.configureKey=function(e){var t,o=0;$("#box2 .function").each(function(){for(t=$(this),o=0;o<e.length;o++)if(t.hasClass(e[o]))return t.addClass("enabled"),!0;t.removeClass("enabled")})},haste.prototype.newDocument=function(e){const t=document.getElementsByTagName("code");for(;t.length>0;)t[0].parentNode.removeChild(t[0]);this.$box.hide(),this.doc=new haste_document,this.setTitle(),this.lightKey(),this.$textarea.val("").show("fast",function(){this.focus()}),this.removeLineNumbers()},haste.extensionMap={rb:"ruby",py:"python",pl:"perl",php:"php",scala:"scala",go:"go",xml:"xml",html:"xml",htm:"xml",css:"css",js:"javascript",vbs:"vbscript",lua:"lua",pas:"delphi",java:"java",cpp:"cpp",cc:"cpp",m:"objectivec",vala:"vala",sql:"sql",sm:"smalltalk",lisp:"lisp",ini:"ini",diff:"diff",bash:"bash",sh:"bash",tex:"tex",erl:"erlang",hs:"haskell",md:"markdown",txt:"",coffee:"coffee",swift:"swift"},haste.prototype.lookupExtensionByType=function(e){for(var t in haste.extensionMap)if(haste.extensionMap[t]===e)return t;return e},haste.prototype.lookupTypeByExtension=function(e){return haste.extensionMap[e]||e},haste.prototype.addLineNumbers=function(e){if(removeElementsByClass("linenumber"),window.location.hash){highlightNew(getLineElement(window.location.hash.substring(1)))}},haste.prototype.removeLineNumbers=function(){removeElementsByClass("highlight"),removeElementsByClass("linenumber");let e=document.createElement("a");e.classList.add("linenumber");let t=document.createTextNode(">");e.appendChild(t),document.body.appendChild(e)},haste.prototype.loadDocument=function(e){var t=e.split(".",2),o=this;o.doc=new haste_document,o.doc.load(t[0],function(e){if(e){for(var t=e.value.split(/\r\n|\r|\n/),n=0;n<t.length;n++){let s=document.createElement("code");s.innerHTML=t[n],document.getElementById("box").appendChild(s),s.onclick=function(){var t="/"+e.key+"#"+(n+1).toString();window.history.pushState(null,o.appName+"-"+e.key,t),highlightNew(s)}}o.setTitle(e.key),o.fullKey(),o.$textarea.val("").hide(),o.$box.show().focus(),o.addLineNumbers(e.lineCount)}else o.newDocument()},this.lookupTypeByExtension(t[1]))},haste.prototype.duplicateDocument=function(){if(this.doc.locked){var e=this.doc.data;this.newDocument(),this.$textarea.val(e)}},haste.prototype.lockDocument=function(){var e=this;this.doc.save(this.$textarea.val(),function(t,o){if(t)e.showMessage(t.message,"error");else if(o){const t=o.value.split(/\r\n|\r|\n/);for(let n=0;n<t.length;n++){let s=document.createElement("code");s.innerHTML=t[n],document.getElementById("box").appendChild(s),s.onclick=function(){var t="/"+o.key+"#"+(n+1).toString();window.history.pushState(null,e.appName+"-"+o.key,t),highlightNew(s)}}e.setTitle(o.key);var n="/"+o.key;window.history.pushState(null,e.appName+"-"+o.key,n),e.fullKey(),e.$textarea.val("").hide(),e.$box.show().focus(),e.addLineNumbers(o.lineCount)}})},haste.prototype.configureButtons=function(){var e=this;this.buttons=[{$where:$("#box2 .save"),label:"Save",shortcutDescription:"control + s",shortcut:function(e){return e.ctrlKey&&83===e.keyCode},action:function(){""!==e.$textarea.val().replace(/^\s+|\s+$/g,"")&&e.lockDocument()}},{$where:$("#box2 .new"),label:"New",shortcut:function(e){return e.ctrlKey&&78===e.keyCode},shortcutDescription:"control + n",action:function(){e.newDocument(!e.doc.key)}},{$where:$("#box2 .duplicate"),label:"Duplicate & Edit",shortcut:function(t){return e.doc.locked&&t.ctrlKey&&68===t.keyCode},shortcutDescription:"control + d",action:function(){e.duplicateDocument()}},{$where:$("#box2 .raw"),label:"Just Text",shortcut:function(e){return e.ctrlKey&&e.shiftKey&&82===e.keyCode},shortcutDescription:"control + shift + r",action:function(){window.location.href=workersUrl+"raw/"+e.doc.key}}];for(var t=0;t<this.buttons.length;t++)this.configureButton(this.buttons[t])},haste.prototype.configureButton=function(e){e.$where.click(function(t){t.preventDefault(),!e.clickDisabled&&$(this).hasClass("enabled")&&e.action()}),e.$where.mouseenter(function(){$("#box3 .label").text(e.label),$("#box3 .shortcut").text(e.shortcutDescription||""),$("#box3").show(),$(this).append($("#pointer").remove().show())}),e.$where.mouseleave(function(){$("#box3").hide(),$("#pointer").hide()})},haste.prototype.configureShortcuts=function(){var e=this;$(document.body).keydown(function(t){for(var o,n=0;n<e.buttons.length;n++)if((o=e.buttons[n]).shortcut&&o.shortcut(t))return t.preventDefault(),void o.action()})},$(function(){$("textarea").keydown(function(e){if(9===e.keyCode){e.preventDefault();if(document.selection)this.focus(),document.selection.createRange().text="  ",this.focus();else if(this.selectionStart||"0"==this.selectionStart){var t=this.selectionStart,o=this.selectionEnd,n=this.scrollTop;this.value=this.value.substring(0,t)+"  "+this.value.substring(o,this.value.length),this.focus(),this.selectionStart=t+"  ".length,this.selectionEnd=t+"  ".length,this.scrollTop=n}else this.value+="  ",this.focus()}})});